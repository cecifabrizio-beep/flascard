<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giapponese SRS v7.2 (Fix Import)</title>
    <style>
        /* --- STILE GENERALE --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f2f2f7; color: #333; margin: 0; padding: 15px;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }
        h1 { color: #1c1c1e; margin-bottom: 20px; text-align: center; font-size: 1.5rem; }
        h2 { font-size: 1.2rem; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; color: #007aff; }
        h4 { margin-top: 30px; margin-bottom: 10px; color: #555; border-left: 4px solid #34c759; padding-left: 8px; font-size: 1.1rem; }
        .container { width: 100%; max-width: 600px; margin-bottom: 50px; }
        
        .card {
            background: #ffffff; padding: 20px; border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px;
        }

        /* --- MENU --- */
        #main-nav {
            display: flex; gap: 5px; width: 100%; max-width: 600px; margin-bottom: 20px;
            overflow-x: auto; padding-bottom: 5px;
        }
        .nav-btn {
            flex: 1; padding: 10px; border: none; border-radius: 8px;
            background-color: #e5e5ea; color: #007aff; font-weight: 600;
            cursor: pointer; white-space: nowrap; transition: 0.2s; text-align: center; font-size: 0.9rem;
        }
        .nav-btn.active { background-color: #007aff; color: white; box-shadow: 0 2px 8px rgba(0,122,255,0.4); }

        .modulo-content { display: none; }
        .active-module { display: block; }

        /* --- UI ELEMENTI --- */
        .input-box {
            width: 100%; padding: 12px; font-size: 1.1rem; border: 2px solid #ddd;
            border-radius: 8px; box-sizing: border-box; margin-bottom: 10px; text-align: center;
        }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; color: white; margin-top: 5px; }
        .btn-blue { background-color: #007aff; }
        .btn-green { background-color: #34c759; }
        .btn-red { background-color: #ff3b30; }
        
        /* --- QUIZ --- */
        #prompt-container { text-align: center; margin: 20px 0; min-height: 100px; display: flex; flex-direction: column; justify-content: center; }
        #prompt-label { font-size: 0.8rem; font-weight: bold; color: #999; text-transform: uppercase; margin-bottom: 5px; }
        #prompt-principale { font-size: 2.2rem; margin: 5px 0; color: #333; }
        #prompt-secondario { font-size: 1.1rem; color: #666; font-style: italic; }
        #risultato-controllo { text-align: center; font-weight: bold; min-height: 30px; margin: 10px 0; }
        .corretto { color: #34c759; } .sbagliato { color: #ff3b30; }

        /* --- ASCOLTO --- */
        .frase-entry { display: flex; align-items: center; background: #f9f9f9; border: 1px solid #eee; border-radius: 10px; padding: 12px; margin-bottom: 10px; gap: 12px; }
        .play-btn { width: 44px; height: 44px; border-radius: 50%; background: #34c759; color: white; border: none; font-size: 1.2rem; cursor: pointer; flex-shrink: 0; display: flex; justify-content: center; align-items: center; }
        .frase-text { flex-grow: 1; }
        .frase-jpn { font-weight: bold; font-size: 1.1rem; display: block; }
        .frase-ita { color: #007aff; font-size: 0.95rem; display: block; cursor: pointer; }
        .spoiler .frase-ita { background: #ddd; color: transparent; border-radius: 4px; }
        .spoiler .frase-ita:hover { background: transparent; color: #007aff; }

        /* --- KANA CONFIG & TABLES --- */
        .kana-config { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #eee; }
        .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; text-align: left; }
        .checkbox-label { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; }
        
        .table-wrap { overflow-x: auto; margin-bottom: 20px; border: 1px solid #eee; border-radius: 8px; }
        .kana-table { width: 100%; border-collapse: collapse; min-width: 320px; text-align: center; }
        .kana-table th { background: #f2f2f7; padding: 8px; color: #666; font-size: 0.9rem; }
        .kana-table td { border: 1px solid #ddd; padding: 8px; vertical-align: middle; }
        .kc { font-size: 1.4rem; font-weight: bold; display: block; color: #333; }
        .kr { font-size: 0.75rem; color: #999; display: block; }

        /* --- GESTIONE --- */
        .import-section { border: 2px dashed #ccc; padding: 15px; border-radius: 8px; margin-bottom: 20px; background: #fafafa; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <h1>Set di Studio Giapponese</h1>

    <nav id="main-nav">
        <button class="nav-btn active" onclick="showTab('quiz'); setQuizMode('vocaboli')">Quiz Vocaboli</button>
        <button class="nav-btn" onclick="showTab('ascolto')">üéß Ascolto</button>
        <button class="nav-btn" onclick="showTab('hiragana')">Hiragana</button>
        <button class="nav-btn" onclick="showTab('katakana')">Katakana</button>
        <button class="nav-btn" onclick="showTab('gestione')">‚öôÔ∏è Gestione</button>
    </nav>

    <div class="container">

        <div id="tab-quiz" class="modulo-content active-module">
            <div class="card">
                <div id="punteggio-container" style="text-align:center; color:#888; margin-bottom:10px;">Sessione pronta</div>
                
                <div id="filtro-wrapper">
                    <select id="filtro-categoria" class="input-box" style="font-size:1rem;" onchange="nuovaSessione()">
                        <option value="TUTTI">Tutte le Categorie</option>
                    </select>
                </div>

                <div id="quiz-box">
                    <div id="prompt-container">
                        <div id="q-label"></div>
                        <div id="prompt-principale"></div>
                        <div id="prompt-secondario"></div>
                    </div>

                    <input type="text" id="input-risposta" class="input-box" placeholder="Risposta..." autocomplete="off">
                    
                    <div id="risultato-controllo"></div>

                    <button id="btn-controlla" class="btn btn-blue" onclick="controlla()">Controlla</button>
                    <button id="btn-prossima" class="btn btn-green hidden" onclick="prossima()">Prossima</button>
                </div>
                
                <div id="no-data-msg" class="hidden" style="text-align:center; padding:20px; color:#666;">
                    Nessun dato caricato.<br>Vai su <b>‚öôÔ∏è Gestione</b> per caricare i dati.
                </div>
            </div>
        </div>

        <div id="tab-ascolto" class="modulo-content">
            <div class="card">
                <h2>Ascolto Frasi</h2>
                <select id="filtro-frasi" class="input-box" style="font-size:1rem;" onchange="renderFrasi()">
                    <option value="TUTTI">Tutte le Frasi</option>
                </select>
                <div style="text-align: center; margin-bottom: 15px;">
                    <label><input type="checkbox" id="spoiler-check" onchange="renderFrasi()"> Nascondi Italiano</label>
                </div>
                <div id="lista-frasi"></div>
                <div id="no-frasi-msg" class="hidden" style="text-align:center; padding:20px; color:#666;">
                    Nessuna frase caricata.
                </div>
            </div>
        </div>

        <div id="tab-gestione" class="modulo-content">
            <div class="card">
                <h2>Gestione Dati</h2>
                
                <div class="import-section">
                    <h3>1. Vocaboli (CSV)</h3>
                    <div style="display:flex; gap:5px; margin-bottom:10px;">
                        <input type="text" id="url-vocaboli" class="input-box" style="margin:0; font-size:0.9rem;" placeholder="Link RAW GitHub...">
                        <button class="btn btn-blue" style="width:auto; margin:0;" onclick="scaricaDaGithub('vocaboli')">Scarica</button>
                    </div>
                    <input type="file" accept=".csv" onchange="importaFileLocale(this, 'vocaboli')">
                    <p style="font-size:0.8rem; color:#888;">Formato: Ita,Eng,Jpn,Rom,Tag</p>
                </div>

                <div class="import-section">
                    <h3>2. Frasi (CSV)</h3>
                    <div style="display:flex; gap:5px; margin-bottom:10px;">
                        <input type="text" id="url-frasi" class="input-box" style="margin:0; font-size:0.9rem;" placeholder="Link RAW GitHub...">
                        <button class="btn btn-blue" style="width:auto; margin:0;" onclick="scaricaDaGithub('frasi')">Scarica</button>
                    </div>
                    <input type="file" accept=".csv" onchange="importaFileLocale(this, 'frasi')">
                    <p style="font-size:0.8rem; color:#888;">Formato: Ita,Rom,Jpn,Tag</p>
                </div>

                <div style="text-align:center; border-top:1px solid #eee; padding-top:15px;">
                    <p>Vocaboli in memoria: <b id="count-vocab">0</b></p>
                    <p>Frasi in memoria: <b id="count-frasi">0</b></p>
                    <button class="btn btn-red" onclick="cancellaTutto()">üóë CANCELLA TUTTO</button>
                </div>
            </div>
        </div>

        <div id="tab-hiragana" class="modulo-content">
            <div class="card">
                <h2>Hiragana</h2>
                
                <div class="kana-config">
                    <h3 style="margin-top:0; font-size:1rem; color:#555;">Quiz Alfabeto</h3>
                    <div class="config-grid" id="h-config-grid"></div>
                    <button class="btn btn-green" onclick="avviaQuizKana('hiragana')">üèãÔ∏è AVVIA QUIZ HIRAGANA</button>
                </div>

                <h4>Suoni Base (Goj≈´on)</h4>
                <div class="table-wrap">
                    <table class="kana-table">
                        <tr><th>-</th><th>A</th><th>I</th><th>U</th><th>E</th><th>O</th></tr>
                        <tr><th>-</th><td><span class="kc">„ÅÇ</span><span class="kr">a</span></td><td><span class="kc">„ÅÑ</span><span class="kr">i</span></td><td><span class="kc">„ÅÜ</span><span class="kr">u</span></td><td><span class="kc">„Åà</span><span class="kr">e</span></td><td><span class="kc">„Åä</span><span class="kr">o</span></td></tr>
                        <tr><th>K</th><td><span class="kc">„Åã</span><span class="kr">ka</span></td><td><span class="kc">„Åç</span><span class="kr">ki</span></td><td><span class="kc">„Åè</span><span class="kr">ku</span></td><td><span class="kc">„Åë</span><span class="kr">ke</span></td><td><span class="kc">„Åì</span><span class="kr">ko</span></td></tr>
                        <tr><th>S</th><td><span class="kc">„Åï</span><span class="kr">sa</span></td><td><span class="kc">„Åó</span><span class="kr">shi</span></td><td><span class="kc">„Åô</span><span class="kr">su</span></td><td><span class="kc">„Åõ</span><span class="kr">se</span></td><td><span class="kc">„Åù</span><span class="kr">so</span></td></tr>
                        <tr><th>T</th><td><span class="kc">„Åü</span><span class="kr">ta</span></td><td><span class="kc">„Å°</span><span class="kr">chi</span></td><td><span class="kc">„Å§</span><span class="kr">tsu</span></td><td><span class="kc">„Å¶</span><span class="kr">te</span></td><td><span class="kc">„Å®</span><span class="kr">to</span></td></tr>
                        <tr><th>N</th><td><span class="kc">„Å™</span><span class="kr">na</span></td><td><span class="kc">„Å´</span><span class="kr">ni</span></td><td><span class="kc">„Å¨</span><span class="kr">nu</span></td><td><span class="kc">„Å≠</span><span class="kr">ne</span></td><td><span class="kc">„ÅÆ</span><span class="kr">no</span></td></tr>
                        <tr><th>H</th><td><span class="kc">„ÅØ</span><span class="kr">ha</span></td><td><span class="kc">„Å≤</span><span class="kr">hi</span></td><td><span class="kc">„Åµ</span><span class="kr">fu</span></td><td><span class="kc">„Å∏</span><span class="kr">he</span></td><td><span class="kc">„Åª</span><span class="kr">ho</span></td></tr>
                        <tr><th>M</th><td><span class="kc">„Åæ</span><span class="kr">ma</span></td><td><span class="kc">„Åø</span><span class="kr">mi</span></td><td><span class="kc">„ÇÄ</span><span class="kr">mu</span></td><td><span class="kc">„ÇÅ</span><span class="kr">me</span></td><td><span class="kc">„ÇÇ</span><span class="kr">mo</span></td></tr>
                        <tr><th>Y</th><td><span class="kc">„ÇÑ</span><span class="kr">ya</span></td><td></td><td><span class="kc">„ÇÜ</span><span class="kr">yu</span></td><td></td><td><span class="kc">„Çà</span><span class="kr">yo</span></td></tr>
                        <tr><th>R</th><td><span class="kc">„Çâ</span><span class="kr">ra</span></td><td><span class="kc">„Çä</span><span class="kr">ri</span></td><td><span class="kc">„Çã</span><span class="kr">ru</span></td><td><span class="kc">„Çå</span><span class="kr">re</span></td><td><span class="kc">„Çç</span><span class="kr">ro</span></td></tr>
                        <tr><th>W</th><td><span class="kc">„Çè</span><span class="kr">wa</span></td><td></td><td></td><td></td><td><span class="kc">„Çí</span><span class="kr">wo</span></td></tr>
                        <tr><th>N</th><td><span class="kc">„Çì</span><span class="kr">n</span></td><td></td><td></td><td></td><td></td></tr>
                    </table>
                </div>

                <h4>Suoni Impuri (Dakuten)</h4>
                <div class="table-wrap">
                    <table class="kana-table">
                         <tr><th>-</th><th>A</th><th>I</th><th>U</th><th>E</th><th>O</th></tr>
                         <tr><th>G</th><td><span class="kc">„Åå</span><span class="kr">ga</span></td><td><span class="kc">„Åé</span><span class="kr">gi</span></td><td><span class="kc">„Åê</span><span class="kr">gu</span></td><td><span class="kc">„Åí</span><span class="kr">ge</span></td><td><span class="kc">„Åî</span><span class="kr">go</span></td></tr>
                         <tr><th>Z</th><td><span class="kc">„Åñ</span><span class="kr">za</span></td><td><span class="kc">„Åò</span><span class="kr">ji</span></td><td><span class="kc">„Åö</span><span class="kr">zu</span></td><td><span class="kc">„Åú</span><span class="kr">ze</span></td><td><span class="kc">„Åû</span><span class="kr">zo</span></td></tr>
                         <tr><th>D</th><td><span class="kc">„Å†</span><span class="kr">da</span></td><td><span class="kc">„Å¢</span><span class="kr">ji</span></td><td><span class="kc">„Å•</span><span class="kr">zu</span></td><td><span class="kc">„Åß</span><span class="kr">de</span></td><td><span class="kc">„Å©</span><span class="kr">do</span></td></tr>
                         <tr><th>B</th><td><span class="kc">„Å∞</span><span class="kr">ba</span></td><td><span class="kc">„Å≥</span><span class="kr">bi</span></td><td><span class="kc">„Å∂</span><span class="kr">bu</span></td><td><span class="kc">„Åπ</span><span class="kr">be</span></td><td><span class="kc">„Åº</span><span class="kr">bo</span></td></tr>
                         <tr><th>P</th><td><span class="kc">„Å±</span><span class="kr">pa</span></td><td><span class="kc">„Å¥</span><span class="kr">pi</span></td><td><span class="kc">„Å∑</span><span class="kr">pu</span></td><td><span class="kc">„Å∫</span><span class="kr">pe</span></td><td><span class="kc">„ÅΩ</span><span class="kr">po</span></td></tr>
                    </table>
                </div>

                <h4>Suoni Contratti (Yoon)</h4>
                <div class="table-wrap">
                    <table class="kana-table">
                         <tr><th>-</th><th>YA</th><th>YU</th><th>YO</th></tr>
                         <tr><th>K</th><td><span class="kc">„Åç„ÇÉ</span><span class="kr">kya</span></td><td><span class="kc">„Åç„ÇÖ</span><span class="kr">kyu</span></td><td><span class="kc">„Åç„Çá</span><span class="kr">kyo</span></td></tr>
                         <tr><th>S</th><td><span class="kc">„Åó„ÇÉ</span><span class="kr">sha</span></td><td><span class="kc">„Åó„ÇÖ</span><span class="kr">shu</span></td><td><span class="kc">„Åó„Çá</span><span class="kr">sho</span></td></tr>
                         <tr><th>C</th><td><span class="kc">„Å°„ÇÉ</span><span class="kr">cha</span></td><td><span class="kc">„Å°„ÇÖ</span><span class="kr">chu</span></td><td><span class="kc">„Å°„Çá</span><span class="kr">cho</span></td></tr>
                         <tr><th>N</th><td><span class="kc">„Å´„ÇÉ</span><span class="kr">nya</span></td><td><span class="kc">„Å´„ÇÖ</span><span class="kr">nyu</span></td><td><span class="kc">„Å´„Çá</span><span class="kr">nyo</span></td></tr>
                         <tr><th>H</th><td><span class="kc">„Å≤„ÇÉ</span><span class="kr">hya</span></td><td><span class="kc">„Å≤„ÇÖ</span><span class="kr">hyu</span></td><td><span class="kc">„Å≤„Çá</span><span class="kr">hyo</span></td></tr>
                         <tr><th>M</th><td><span class="kc">„Åø„ÇÉ</span><span class="kr">mya</span></td><td><span class="kc">„Éü„É•</span><span class="kr">myu</span></td><td><span class="kc">„Åø„Çá</span><span class="kr">myo</span></td></tr>
                         <tr><th>R</th><td><span class="kc">„Çä„ÇÉ</span><span class="kr">rya</span></td><td><span class="kc">„É™„É•</span><span class="kr">ryu</span></td><td><span class="kc">„É™„Éß</span><span class="kr">ryo</span></td></tr>
                         <tr><th>G</th><td><span class="kc">„Åé„ÇÉ</span><span class="kr">gya</span></td><td><span class="kc">„ÇÆ„É•</span><span class="kr">gyu</span></td><td><span class="kc">„ÇÆ„Éß</span><span class="kr">gyo</span></td></tr>
                         <tr><th>J</th><td><span class="kc">„Åò„ÇÉ</span><span class="kr">ja</span></td><td><span class="kc">„Ç∏„É•</span><span class="kr">ju</span></td><td><span class="kc">„Ç∏„Éß</span><span class="kr">jo</span></td></tr>
                         <tr><th>B</th><td><span class="kc">„Éì„É£</span><span class="kr">bya</span></td><td><span class="kc">„Éì„É•</span><span class="kr">byu</span></td><td><span class="kc">„Éì„Éß</span><span class="kr">byo</span></td></tr>
                         <tr><th>P</th><td><span class="kc">„Éî„É£</span><span class="kr">pya</span></td><td><span class="kc">„Éî„É•</span><span class="kr">pyu</span></td><td><span class="kc">„Éî„Éß</span><span class="kr">pyo</span></td></tr>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-katakana" class="modulo-content">
            <div class="card">
                <h2>Katakana</h2>
                
                <div class="kana-config">
                    <h3 style="margin-top:0; font-size:1rem; color:#555;">Quiz Alfabeto</h3>
                    <div class="config-grid" id="k-config-grid"></div>
                    <button class="btn btn-green" onclick="avviaQuizKana('katakana')">üèãÔ∏è AVVIA QUIZ KATAKANA</button>
                </div>

                <h4>Suoni Base (Goj≈´on)</h4>
                <div class="table-wrap">
                    <table class="kana-table">
                        <tr><th>-</th><th>A</th><th>I</th><th>U</th><th>E</th><th>O</th></tr>
                        <tr><th>-</th><td><span class="kc">„Ç¢</span><span class="kr">a</span></td><td><span class="kc">„Ç§</span><span class="kr">i</span></td><td><span class="kc">„Ç¶</span><span class="kr">u</span></td><td><span class="kc">„Ç®</span><span class="kr">e</span></td><td><span class="kc">„Ç™</span><span class="kr">o</span></td></tr>
                        <tr><th>K</th><td><span class="kc">„Ç´</span><span class="kr">ka</span></td><td><span class="kc">„Ç≠</span><span class="kr">ki</span></td><td><span class="kc">„ÇØ</span><span class="kr">ku</span></td><td><span class="kc">„Ç±</span><span class="kr">ke</span></td><td><span class="kc">„Ç≥</span><span class="kr">ko</span></td></tr>
                        <tr><th>S</th><td><span class="kc">„Çµ</span><span class="kr">sa</span></td><td><span class="kc">„Ç∑</span><span class="kr">shi</span></td><td><span class="kc">„Çπ</span><span class="kr">su</span></td><td><span class="kc">„Çª</span><span class="kr">se</span></td><td><span class="kc">„ÇΩ</span><span class="kr">so</span></td></tr>
                        <tr><th>T</th><td><span class="kc">„Çø</span><span class="kr">ta</span></td><td><span class="kc">„ÉÅ</span><span class="kr">chi</span></td><td><span class="kc">„ÉÑ</span><span class="kr">tsu</span></td><td><span class="kc">„ÉÜ</span><span class="kr">te</span></td><td><span class="kc">„Éà</span><span class="kr">to</span></td></tr>
                        <tr><th>N</th><td><span class="kc">„Éä</span><span class="kr">na</span></td><td><span class="kc">„Éã</span><span class="kr">ni</span></td><td><span class="kc">„Éå</span><span class="kr">nu</span></td><td><span class="kc">„Éç</span><span class="kr">ne</span></td><td><span class="kc">„Éé</span><span class="kr">no</span></td></tr>
                        <tr><th>H</th><td><span class="kc">„Éè</span><span class="kr">ha</span></td><td><span class="kc">„Éí</span><span class="kr">hi</span></td><td><span class="kc">„Éï</span><span class="kr">fu</span></td><td><span class="kc">„Éò</span><span class="kr">he</span></td><td><span class="kc">„Éõ</span><span class="kr">ho</span></td></tr>
                        <tr><th>M</th><td><span class="kc">„Éû</span><span class="kr">ma</span></td><td><span class="kc">„Éü</span><span class="kr">mi</span></td><td><span class="kc">„É†</span><span class="kr">mu</span></td><td><span class="kc">„É°</span><span class="kr">me</span></td><td><span class="kc">„É¢</span><span class="kr">mo</span></td></tr>
                        <tr><th>Y</th><td><span class="kc">„É§</span><span class="kr">ya</span></td><td></td><td><span class="kc">„É¶</span><span class="kr">yu</span></td><td></td><td><span class="kc">„É®</span><span class="kr">yo</span></td></tr>
                        <tr><th>R</th><td><span class="kc">„É©</span><span class="kr">ra</span></td><td><span class="kc">„É™</span><span class="kr">ri</span></td><td><span class="kc">„É´</span><span class="kr">ru</span></td><td><span class="kc">„É¨</span><span class="kr">re</span></td><td><span class="kc">„É≠</span><span class="kr">ro</span></td></tr>
                        <tr><th>W</th><td><span class="kc">„ÉØ</span><span class="kr">wa</span></td><td></td><td></td><td></td><td><span class="kc">„É≤</span><span class="kr">wo</span></td></tr>
                        <tr><th>N</th><td><span class="kc">„É≥</span><span class="kr">n</span></td><td></td><td></td><td></td><td></td></tr>
                    </table>
                </div>

                <h4>Suoni Impuri (Dakuten)</h4>
                <div class="table-wrap">
                    <table class="kana-table">
                         <tr><th>-</th><th>A</th><th>I</th><th>U</th><th>E</th><th>O</th></tr>
                         <tr><th>G</th><td><span class="kc">„Ç¨</span><span class="kr">ga</span></td><td><span class="kc">„ÇÆ</span><span class="kr">gi</span></td><td><span class="kc">„Ç∞</span><span class="kr">gu</span></td><td><span class="kc">„Ç≤</span><span class="kr">ge</span></td><td><span class="kc">„Ç¥</span><span class="kr">go</span></td></tr>
                         <tr><th>Z</th><td><span class="kc">„Ç∂</span><span class="kr">za</span></td><td><span class="kc">„Ç∏</span><span class="kr">ji</span></td><td><span class="kc">„Ç∫</span><span class="kr">zu</span></td><td><span class="kc">„Çº</span><span class="kr">ze</span></td><td><span class="kc">„Çæ</span><span class="kr">zo</span></td></tr>
                         <tr><th>D</th><td><span class="kc">„ÉÄ</span><span class="kr">da</span></td><td><span class="kc">„ÉÇ</span><span class="kr">ji</span></td><td><span class="kc">„ÉÖ</span><span class="kr">zu</span></td><td><span class="kc">„Éá</span><span class="kr">de</span></td><td><span class="kc">„Éâ</span><span class="kr">do</span></td></tr>
                         <tr><th>B</th><td><span class="kc">„Éê</span><span class="kr">ba</span></td><td><span class="kc">„Éì</span><span class="kr">bi</span></td><td><span class="kc">„Éñ</span><span class="kr">bu</span></td><td><span class="kc">„Éô</span><span class="kr">be</span></td><td><span class="kc">„Éú</span><span class="kr">bo</span></td></tr>
                         <tr><th>P</th><td><span class="kc">„Éë</span><span class="kr">pa</span></td><td><span class="kc">„Éî</span><span class="kr">pi</span></td><td><span class="kc">„Éó</span><span class="kr">pu</span></td><td><span class="kc">„Éö</span><span class="kr">pe</span></td><td><span class="kc">„Éù</span><span class="kr">po</span></td></tr>
                    </table>
                </div>

                <h4>Suoni Contratti (Yoon)</h4>
                <div class="table-wrap">
                    <table class="kana-table">
                         <tr><th>-</th><th>YA</th><th>YU</th><th>YO</th></tr>
                         <tr><th>K</th><td><span class="kc">„Ç≠„É£</span><span class="kr">kya</span></td><td><span class="kc">„Ç≠„É•</span><span class="kr">kyu</span></td><td><span class="kc">„Ç≠„Éß</span><span class="kr">kyo</span></td></tr>
                         <tr><th>S</th><td><span class="kc">„Ç∑„É£</span><span class="kr">sha</span></td><td><span class="kc">„Ç∑„É•</span><span class="kr">shu</span></td><td><span class="kc">„Ç∑„Éß</span><span class="kr">sho</span></td></tr>
                         <tr><th>C</th><td><span class="kc">„ÉÅ„É£</span><span class="kr">cha</span></td><td><span class="kc">„ÉÅ„É•</span><span class="kr">chu</span></td><td><span class="kc">„ÉÅ„Éß</span><span class="kr">cho</span></td></tr>
                         <tr><th>N</th><td><span class="kc">„Éã„É£</span><span class="kr">nya</span></td><td><span class="kc">„Éã„É•</span><span class="kr">nyu</span></td><td><span class="kc">„Éã„Éß</span><span class="kr">nyo</span></td></tr>
                         <tr><th>H</th><td><span class="kc">„Éí„É£</span><span class="kr">hya</span></td><td><span class="kc">„Éí„É•</span><span class="kr">hyu</span></td><td><span class="kc">„Éí„Éß</span><span class="kr">hyo</span></td></tr>
                         <tr><th>M</th><td><span class="kc">„Éü„É£</span><span class="kr">mya</span></td><td><span class="kc">„Éü„É•</span><span class="kr">myu</span></td><td><span class="kc">„Éü„Éß</span><span class="kr">myo</span></td></tr>
                         <tr><th>R</th><td><span class="kc">„É™„É£</span><span class="kr">rya</span></td><td><span class="kc">„É™„É•</span><span class="kr">ryu</span></td><td><span class="kc">„É™„Éß</span><span class="kr">ryo</span></td></tr>
                         <tr><th>G</th><td><span class="kc">„ÇÆ„É£</span><span class="kr">gya</span></td><td><span class="kc">„ÇÆ„É•</span><span class="kr">gyu</span></td><td><span class="kc">„ÇÆ„Éß</span><span class="kr">gyo</span></td></tr>
                         <tr><th>J</th><td><span class="kc">„Ç∏„É£</span><span class="kr">ja</span></td><td><span class="kc">„Ç∏„É•</span><span class="kr">ju</span></td><td><span class="kc">„Ç∏„Éß</span><span class="kr">jo</span></td></tr>
                         <tr><th>B</th><td><span class="kc">„Éì„É£</span><span class="kr">bya</span></td><td><span class="kc">„Éì„É•</span><span class="kr">byu</span></td><td><span class="kc">„Éì„Éß</span><span class="kr">byo</span></td></tr>
                         <tr><th>P</th><td><span class="kc">„Éî„É£</span><span class="kr">pya</span></td><td><span class="kc">„Éî„É•</span><span class="kr">pyu</span></td><td><span class="kc">„Éî„Éß</span><span class="kr">pyo</span></td></tr>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- DEFINIZIONE FUNZIONI GLOBALI (PRIMA DI TUTTO) ---

        function showTab(id) {
            document.querySelectorAll('.modulo-content').forEach(d => d.classList.remove('active-module'));
            document.getElementById('tab-' + id).classList.add('active-module');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function setQuizMode(mode) {
            modalitaQuiz = mode;
            const wrapper = document.getElementById('filtro-wrapper');
            if (mode === 'vocaboli') {
                wrapper.classList.remove('hidden');
                nuovaSessione(); 
            } else {
                wrapper.classList.add('hidden');
            }
        }

        // --- GESTIONE DATI ---
        function caricaDati() {
            try {
                const v = localStorage.getItem(KEY_V);
                const f = localStorage.getItem(KEY_F);
                if (v) vocaboli = JSON.parse(v);
                if (f) frasi = JSON.parse(f);
            } catch (e) {
                console.error("Errore caricamento dati:", e);
                localStorage.clear(); // Reset emergenza
            }
        }

        function aggiornaUI() {
            document.getElementById('count-vocab').innerText = vocaboli.length;
            document.getElementById('count-frasi').innerText = frasi.length;
            popolaFiltroCategorie();
            popolaFiltroFrasi();
            renderFrasi();
            if(modalitaQuiz === 'vocaboli') nuovaSessione();
        }

        function scaricaDaGithub(tipo) {
            const urlInput = document.getElementById(tipo === 'vocaboli' ? 'url-vocaboli' : 'url-frasi');
            const url = urlInput.value.trim();
            if (!url) { alert("Inserisci un link valido!"); return; }
            fetch(url).then(r => r.text()).then(t => {
                if (tipo === 'vocaboli') parseVocaboli(t); else parseFrasi(t);
                alert("Fatto!"); aggiornaUI();
            }).catch(e => alert("Errore: " + e));
        }

        function importaFileLocale(input, tipo) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                if (tipo === 'vocaboli') parseVocaboli(e.target.result); else parseFrasi(e.target.result);
                alert("Fatto!"); aggiornaUI();
            };
            reader.readAsText(file);
        }

        function parseVocaboli(csv) {
            // Formato: Ita, Eng, Jpn, Rom, Tag
            vocaboli = [];
            const lines = csv.split(/\r?\n/); // Gestione sicura ritorni a capo
            lines.forEach(line => {
                if(!line.trim()) return;
                const parts = line.split(',');
                if (parts.length >= 4) {
                    vocaboli.push({
                        ita: parts[0].trim(),
                        eng: parts[1].trim(),
                        jpn: parts[2].trim(),
                        rom: parts[3].trim(),
                        tag: parts[4] ? parts[4].trim() : 'Generale'
                    });
                }
            });
            localStorage.setItem(KEY_V, JSON.stringify(vocaboli));
        }

        function parseFrasi(csv) {
            // Formato: Ita, Rom, Jpn, Tag
            frasi = [];
            const lines = csv.split(/\r?\n/);
            lines.forEach(line => {
                if(!line.trim()) return;
                const parts = line.split(',');
                if (parts.length >= 3) {
                    frasi.push({
                        ita: parts[0].trim(),
                        rom: parts[1].trim(),
                        jpn: parts[2].trim(),
                        tag: parts[3] ? parts[3].trim() : 'Generale'
                    });
                }
            });
            localStorage.setItem(KEY_F, JSON.stringify(frasi));
        }

        function cancellaTutto() {
            if(!confirm("Sicuro?")) return;
            vocaboli = []; frasi = [];
            localStorage.removeItem(KEY_V); localStorage.removeItem(KEY_F);
            location.reload();
        }

        // --- KANA CONFIG ---
        function generaConfigPanel(prefix) {
            const container = document.getElementById(prefix + '-config-grid');
            if(!container) return;
            container.innerHTML = '';
            for (const [label, range] of Object.entries(KANA_ROWS)) {
                container.innerHTML += `<label class="checkbox-label"><input type="checkbox" value="${label}" checked> ${label}</label>`;
            }
        }

        function toggleAllKana(type, status) {
            const prefix = (type === 'hiragana') ? 'h' : 'k';
            document.querySelectorAll(`#${prefix}-config-grid input`).forEach(cb => cb.checked = status);
        }

        function avviaQuizKana(type) {
            const prefix = (type === 'hiragana') ? 'h' : 'k';
            const dataset = (type === 'hiragana') ? HIRAGANA_DATA : KATAKANA_DATA;
            const checkboxes = document.querySelectorAll(`#${prefix}-config-grid input:checked`);
            
            let pool = [];
            checkboxes.forEach(cb => {
                const range = KANA_ROWS[cb.value];
                pool = pool.concat(dataset.slice(range[0], range[1]));
            });

            if (pool.length === 0) { alert("Seleziona almeno una riga!"); return; }

            showTab('quiz');
            modalitaQuiz = type; 
            document.getElementById('filtro-wrapper').classList.add('hidden');
            
            sessione = pool.sort(() => 0.5 - Math.random()).map(k => ({
                ita: k.r, jpn: k.k, type: 'kana'
            }));
            punteggio = { ok: 0, err: 0 };
            mostraCarta();
        }

        // --- QUIZ LOGIC ---
        function popolaFiltroCategorie() {
            const sel = document.getElementById('filtro-categoria');
            const tags = new Set(vocaboli.map(v => v.tag));
            sel.innerHTML = '<option value="TUTTI">Tutte le Categorie</option>';
            Array.from(tags).sort().forEach(t => { sel.innerHTML += `<option value="${t}">${t}</option>`; });
        }

        function nuovaSessione() {
            setQuizMode('vocaboli');
            const cat = document.getElementById('filtro-categoria').value;
            const pool = (cat === 'TUTTI') ? vocaboli : vocaboli.filter(v => v.tag === cat);
            const msg = document.getElementById('no-data-msg');
            const box = document.getElementById('quiz-box');

            if (pool.length === 0) { box.style.display = 'none'; msg.classList.remove('hidden'); return; }
            box.style.display = 'block'; msg.classList.add('hidden');
            
            sessione = pool.sort(() => 0.5 - Math.random()).slice(0, 10);
            punteggio = { ok: 0, err: 0 };
            mostraCarta();
        }

        function mostraCarta() {
            if (sessione.length === 0) {
                document.getElementById('prompt-principale').innerText = "Fine Sessione!";
                document.getElementById('prompt-secondario').innerText = "";
                document.getElementById('input-risposta').style.display = 'none';
                document.getElementById('btn-controlla').style.display = 'none';
                document.getElementById('btn-prossima').classList.add('hidden');
                return;
            }
            
            document.getElementById('punteggio-container').innerText = `Corretti: ${punteggio.ok} | Errori: ${punteggio.err} | Rimasti: ${sessione.length}`;
            cartaCorrente = sessione.pop();
            const input = document.getElementById('input-risposta');
            input.value = ''; input.disabled = false; input.style.display = 'block'; input.focus();
            document.getElementById('btn-controlla').classList.remove('hidden');
            document.getElementById('btn-controlla').style.display = 'block';
            document.getElementById('btn-prossima').classList.add('hidden');
            document.getElementById('risultato-controllo').innerText = '';

            if (modalitaQuiz === 'vocaboli') {
                const mode = Math.random() > 0.5 ? 'JtoI' : 'ItoJ';
                cartaCorrente.quizMode = mode;
                if (mode === 'JtoI') {
                    document.getElementById('q-label').innerText = "TRADUCI IN ITALIANO";
                    document.getElementById('prompt-principale').innerHTML = `${cartaCorrente.jpn} <span style="font-size:1rem; cursor:pointer" onclick="parla('${cartaCorrente.jpn}')">üîä</span>`;
                    document.getElementById('prompt-secondario').innerText = cartaCorrente.rom;
                } else {
                    document.getElementById('q-label').innerText = "TRADUCI IN GIAPPONESE (ROMAJI)";
                    document.getElementById('prompt-principale').innerText = cartaCorrente.ita;
                    document.getElementById('prompt-secondario').innerText = cartaCorrente.eng;
                }
            } else {
                document.getElementById('q-label').innerText = "SCRIVI IL ROMAJI";
                document.getElementById('prompt-principale').innerText = cartaCorrente.jpn;
                document.getElementById('prompt-secondario').innerText = "";
            }
        }

        function controlla() {
            const user = document.getElementById('input-risposta').value.trim().toLowerCase();
            let ok = false; let ans = "";

            if (modalitaQuiz === 'vocaboli') {
                if (cartaCorrente.quizMode === 'JtoI') {
                    if (user === cartaCorrente.ita.toLowerCase() || user === cartaCorrente.eng.toLowerCase()) ok = true;
                    ans = cartaCorrente.ita;
                } else {
                    if (user === cartaCorrente.rom.toLowerCase() || user === cartaCorrente.jpn) ok = true;
                    ans = `${cartaCorrente.rom} (${cartaCorrente.jpn})`;
                }
            } else {
                if (user === cartaCorrente.ita.toLowerCase()) ok = true;
                ans = cartaCorrente.ita;
            }

            const res = document.getElementById('risultato-controllo');
            if (ok) {
                res.innerHTML = '<span class="corretto">Esatto!</span>';
                punteggio.ok++;
                if(modalitaQuiz === 'vocaboli' && cartaCorrente.quizMode === 'JtoI') parla(cartaCorrente.jpn);
            } else {
                res.innerHTML = `<span class="sbagliato">Sbagliato. Era: ${ans}</span>`;
                punteggio.err++;
            }
            document.getElementById('input-risposta').disabled = true;
            document.getElementById('btn-controlla').classList.add('hidden');
            document.getElementById('btn-prossima').classList.remove('hidden');
            document.getElementById('btn-prossima').focus();
        }

        function prossima() { mostraCarta(); }

        // --- ASCOLTO ---
        function popolaFiltroFrasi() {
            const sel = document.getElementById('filtro-frasi');
            const tags = new Set(frasi.map(f => f.tag));
            sel.innerHTML = '<option value="TUTTI">Tutte le Frasi</option>';
            Array.from(tags).sort().forEach(t => { sel.innerHTML += `<option value="${t}">${t}</option>`; });
        }

        function renderFrasi() {
            const cat = document.getElementById('filtro-frasi').value;
            const spoiler = document.getElementById('spoiler-check').checked;
            const list = document.getElementById('lista-frasi');
            const msg = document.getElementById('no-frasi-msg');
            list.innerHTML = '';

            const items = (cat === 'TUTTI') ? frasi : frasi.filter(f => f.tag === cat);
            if (items.length === 0) { msg.classList.remove('hidden'); return; }
            msg.classList.add('hidden');

            items.forEach(f => {
                const d = document.createElement('div');
                d.className = `frase-entry ${spoiler ? 'spoiler' : ''}`;
                d.innerHTML = `
                    <button class="play-btn" onclick="parla('${f.jpn.replace(/'/g, "\\'")}')">‚ñ∂</button>
                    <div class="frase-text">
                        <span class="frase-jpn">${f.jpn}</span>
                        <span style="font-size:0.8rem; color:#888;">${f.rom}</span>
                        <span class="frase-ita" onclick="this.parentElement.parentElement.classList.remove('spoiler')">${f.ita}</span>
                    </div>
                `;
                list.appendChild(d);
            });
        }

        // --- UTILS ---
        function parla(text) {
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'ja-JP';
            window.speechSynthesis.speak(u);
        }

        // --- DATASETS KANA ---
        const HIRAGANA_DATA = [
            // BASE (0-45)
            {k:'„ÅÇ',r:'a'}, {k:'„ÅÑ',r:'i'}, {k:'„ÅÜ',r:'u'}, {k:'„Åà',r:'e'}, {k:'„Åä',r:'o'},
            {k:'„Åã',r:'ka'}, {k:'„Åç',r:'ki'}, {k:'„Åè',r:'ku'}, {k:'„Åë',r:'ke'}, {k:'„Åì',r:'ko'},
            {k:'„Åï',r:'sa'}, {k:'„Åó',r:'shi'}, {k:'„Åô',r:'su'}, {k:'„Åõ',r:'se'}, {k:'„Åù',r:'so'},
            {k:'„Åü',r:'ta'}, {k:'„Å°',r:'chi'}, {k:'„Å§',r:'tsu'}, {k:'„Å¶',r:'te'}, {k:'„Å®',r:'to'},
            {k:'„Å™',r:'na'}, {k:'„Å´',r:'ni'}, {k:'„Å¨',r:'nu'}, {k:'„Å≠',r:'ne'}, {k:'„ÅÆ',r:'no'},
            {k:'„ÅØ',r:'ha'}, {k:'„Å≤',r:'hi'}, {k:'„Åµ',r:'fu'}, {k:'„Å∏',r:'he'}, {k:'„Åª',r:'ho'},
            {k:'„Åæ',r:'ma'}, {k:'„Åø',r:'mi'}, {k:'„ÇÄ',r:'mu'}, {k:'„ÇÅ',r:'me'}, {k:'„ÇÇ',r:'mo'},
            {k:'„ÇÑ',r:'ya'}, {k:'„ÇÜ',r:'yu'}, {k:'„Çà',r:'yo'},
            {k:'„Çâ',r:'ra'}, {k:'„Çä',r:'ri'}, {k:'„Çã',r:'ru'}, {k:'„Çå',r:'re'}, {k:'„Çç',r:'ro'},
            {k:'„Çè',r:'wa'}, {k:'„Çí',r:'wo'}, {k:'„Çì',r:'n'},
            // DAKUTEN (46-70)
            {k:'„Åå',r:'ga'}, {k:'„Åé',r:'gi'}, {k:'„Åê',r:'gu'}, {k:'„Åí',r:'ge'}, {k:'„Åî',r:'go'},
            {k:'„Åñ',r:'za'}, {k:'„Åò',r:'ji'}, {k:'„Åö',r:'zu'}, {k:'„Åú',r:'ze'}, {k:'„Åû',r:'zo'},
            {k:'„Å†',r:'da'}, {k:'„Å¢',r:'ji'}, {k:'„Å•',r:'zu'}, {k:'„Åß',r:'de'}, {k:'„Å©',r:'do'},
            {k:'„Å∞',r:'ba'}, {k:'„Å≥',r:'bi'}, {k:'„Å∂',r:'bu'}, {k:'„Åπ',r:'be'}, {k:'„Åº',r:'bo'},
            {k:'„Å±',r:'pa'}, {k:'„Å¥',r:'pi'}, {k:'„Å∑',r:'pu'}, {k:'„Å∫',r:'pe'}, {k:'„ÅΩ',r:'po'},
            // YOON (71+)
            {k:'„Åç„ÇÉ',r:'kya'}, {k:'„Åç„ÇÖ',r:'kyu'}, {k:'„Åç„Çá',r:'kyo'}, {k:'„Åó„ÇÉ',r:'sha'}, {k:'„Åó„ÇÖ',r:'shu'}, {k:'„Åó„Çá',r:'sho'},
            {k:'„Å°„ÇÉ',r:'cha'}, {k:'„Å°„ÇÖ',r:'chu'}, {k:'„Å°„Çá',r:'cho'}, {k:'„Å´„ÇÉ',r:'nya'}, {k:'„Å´„ÇÖ',r:'nyu'}, {k:'„Å´„Çá',r:'nyo'},
            {k:'„Å≤„ÇÉ',r:'hya'}, {k:'„Å≤„ÇÖ',r:'hyu'}, {k:'„Å≤„Çá',r:'hyo'}, {k:'„Åø„ÇÉ',r:'mya'}, {k:'„Åø„ÇÖ',r:'myu'}, {k:'„Åø„Çá',r:'myo'},
            {k:'„Çä„ÇÉ',r:'rya'}, {k:'„Çä„ÇÖ',r:'ryu'}, {k:'„Çä„Çá',r:'ryo'}, {k:'„Åé„ÇÉ',r:'gya'}, {k:'„Åé„ÇÖ',r:'gyu'}, {k:'„Åé„Çá',r:'gyo'},
            {k:'„Åò„ÇÉ',r:'ja'}, {k:'„Åò„ÇÖ',r:'ju'}, {k:'„Åò„Çá',r:'jo'}, {k:'„Å≥„ÇÉ',r:'bya'}, {k:'„Å≥„ÇÖ',r:'byu'}, {k:'„Å≥„Çá',r:'byo'},
            {k:'„Å¥„ÇÉ',r:'pya'}, {k:'„Å¥„ÇÖ',r:'pyu'}, {k:'„Å¥„Çá',r:'pyo'}
        ];

        const KATAKANA_DATA = [
            // BASE
            {k:'„Ç¢',r:'a'}, {k:'„Ç§',r:'i'}, {k:'„Ç¶',r:'u'}, {k:'„Ç®',r:'e'}, {k:'„Ç™',r:'o'},
            {k:'„Ç´',r:'ka'}, {k:'„Ç≠',r:'ki'}, {k:'„ÇØ',r:'ku'}, {k:'„Ç±',r:'ke'}, {k:'„Ç≥',r:'ko'},
            {k:'„Çµ',r:'sa'}, {k:'„Ç∑',r:'shi'}, {k:'„Çπ',r:'su'}, {k:'„Çª',r:'se'}, {k:'„ÇΩ',r:'so'},
            {k:'„Çø',r:'ta'}, {k:'„ÉÅ',r:'chi'}, {k:'„ÉÑ',r:'tsu'}, {k:'„ÉÜ',r:'te'}, {k:'„Éà',r:'to'},
            {k:'„Éä',r:'na'}, {k:'„Éã',r:'ni'}, {k:'„Éå',r:'nu'}, {k:'„Éç',r:'ne'}, {k:'„Éé',r:'no'},
            {k:'„Éè',r:'ha'}, {k:'„Éí',r:'hi'}, {k:'„Éï',r:'fu'}, {k:'„Éò',r:'he'}, {k:'„Éõ',r:'ho'},
            {k:'„Éû',r:'ma'}, {k:'„Éü',r:'mi'}, {k:'„É†',r:'mu'}, {k:'„É°',r:'me'}, {k:'„É¢',r:'mo'},
            {k:'„É§',r:'ya'}, {k:'„É¶',r:'yu'}, {k:'„É®',r:'yo'},
            {k:'„É©',r:'ra'}, {k:'„É™',r:'ri'}, {k:'„É´',r:'ru'}, {k:'„É¨',r:'re'}, {k:'„É≠',r:'ro'},
            {k:'„ÉØ',r:'wa'}, {k:'„É≤',r:'wo'}, {k:'„É≥',r:'n'},
            // DAKUTEN
            {k:'„Ç¨',r:'ga'}, {k:'„ÇÆ',r:'gi'}, {k:'„Ç∞',r:'gu'}, {k:'„Ç≤',r:'ge'}, {k:'„Ç¥',r:'go'},
            {k:'„Ç∂',r:'za'}, {k:'„Ç∏',r:'ji'}, {k:'„Ç∫',r:'zu'}, {k:'„Çº',r:'ze'}, {k:'„Çæ',r:'zo'},
            {k:'„ÉÄ',r:'da'}, {k:'„ÉÇ',r:'ji'}, {k:'„ÉÖ',r:'zu'}, {k:'„Éá',r:'de'}, {k:'„Éâ',r:'do'},
            {k:'„Éê',r:'ba'}, {k:'„Éì',r:'bi'}, {k:'„Éñ',r:'bu'}, {k:'„Éô',r:'be'}, {k:'„Éú',r:'bo'},
            {k:'„Éë',r:'pa'}, {k:'„Éî',r:'pi'}, {k:'„Éó',r:'pu'}, {k:'„Éö',r:'pe'}, {k:'„Éù',r:'po'},
            // YOON
            {k:'„Ç≠„É£',r:'kya'}, {k:'„Ç≠„É•',r:'kyu'}, {k:'„Ç≠„Éß',r:'kyo'}, {k:'„Ç∑„É£',r:'sha'}, {k:'„Ç∑„É•',r:'shu'}, {k:'„Ç∑„Éß',r:'sho'},
            {k:'„ÉÅ„É£',r:'cha'}, {k:'„ÉÅ„É•',r:'chu'}, {k:'„ÉÅ„Éß',r:'cho'}, {k:'„Éã„É£',r:'nya'}, {k:'„Éã„É•',r:'nyu'}, {k:'„Éã„Éß',r:'nyo'},
            {k:'„Éí„É£',r:'hya'}, {k:'„Éí„É•',r:'hyu'}, {k:'„Éí„Éß',r:'hyo'}, {k:'„Éü„É£',r:'mya'}, {k:'„Éü„É•',r:'myu'}, {k:'„Éü„Éß',r:'myo'},
            {k:'„É™„É£',r:'rya'}, {k:'„É™„É•',r:'ryu'}, {k:'„É™„Éß',r:'ryo'}, {k:'„ÇÆ„É£',r:'gya'}, {k:'„ÇÆ„É•',r:'gyu'}, {k:'„ÇÆ„Éß',r:'gyo'},
            {k:'„Ç∏„É£',r:'ja'}, {k:'„Ç∏„É•',r:'ju'}, {k:'„Ç∏„Éß',r:'jo'}, {k:'„Éì„É£',r:'bya'}, {k:'„Éì„É•',r:'byu'}, {k:'„Éì„Éß',r:'byo'},
            {k:'„Éî„É£',r:'pya'}, {k:'„Éî„É•',r:'pyu'}, {k:'„Éî„Éß',r:'pyo'}
        ];

        const KANA_ROWS = {
            'Vocali (A-O)': [0, 5],
            'Riga K': [5, 10],
            'Riga S': [10, 15],
            'Riga T': [15, 20],
            'Riga N': [20, 25],
            'Riga H': [25, 30],
            'Riga M': [30, 35],
            'Riga Y': [35, 38],
            'Riga R': [38, 43],
            'Riga W/N': [43, 46],
            'Dakuten (G, Z, D, B)': [46, 66],
            'Handakuten (P)': [66, 71],
            'Yoon (Kya, Sha...)': [71, 104]
        };

        // --- VARIABILI GLOBALI ---
        let vocaboli = [];
        let frasi = [];
        let sessione = [];
        let cartaCorrente = null;
        let punteggio = { ok: 0, err: 0 };
        let modalitaQuiz = 'vocaboli'; // 'vocaboli', 'hiragana', 'katakana'

        const KEY_V = 'srs_vocab_v7';
        const KEY_F = 'srs_frasi_v7';

        // --- AVVIO ---
        window.onload = function() {
            caricaDati();
            generaConfigPanel('h');
            generaConfigPanel('k');
            aggiornaUI();

            // Listener Invio
            document.getElementById('input-risposta').addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    if (!document.getElementById('btn-controlla').classList.contains('hidden')) controlla();
                    else prossima();
                }
            });
        };
    </script>
</body>
</html>
